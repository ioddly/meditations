{% extends "base.htm" %}

{% block title %}Journal{% endblock %}

{% block navigation %}
  <div class=pull-right>
    <form class="form-inline pull-xs-right">
      <div class="form-group">
        <input class="form-control" id="journal-new-entry-date" type=text placeholder="New entry" >
      </div>
      <span id="saved-button" class="navbar-btn btn btn-sm octicon octicon-check" title=saved></span>
    </form>
  </div>
{% endblock %}

{% block content %}
<div class=row>
  <div class=col-sm-2 id=journal-nav>
    <ul class="nav nav-tabs" role=tablist>
      <li class=nav-item>
        <a class=active data-toggle=tab href="#chronological" role=tab><span class="octicon octicon-clock"></span>&nbsp;Time&nbsp;</a>
      </li>
      <li class=nav-item>
        <a data-toggle=tab href="#alphabetical" role=tab><span class="octicon octicon-text-size"></span>&nbsp;Title&nbsp;</a>
      </li>
      <li class=nav-item>
        <a data-toggle=tab href="#tag" role=tab><span class="octicon octicon-tag">&nbsp;Tag&nbsp;</span></a>
      </li>
    </ul>

    <div class=tab-content>
      <!-- Chronological navigation links -->
      <div class="tab-pane active" id=chronological role=tabpanel>
        <ul class="list-group navigation-list">
          {% for year in Years %}
          <li><a href="#chrono-nav-{{year.Date}}" data-toggle="collapse" aria-expanded=false aria-controls="#chrono-nav-{{year.Date}}">{{year.Date}} ({{year.Count}})</a></li>
          <ul class=collapse id="chrono-nav-{{year.Date}}" class="list-group navigation-list">
            {% for month in year.Sub %}
            <li><a href="#view/{{month.Link}}">{{month.Date}} ({{month.Count}})</a></li>
            {% endfor %}
          </ul>
          {% endfor %}
        </ul>
      </div>

      <!-- Alphabetical navigation links -->
      <div class="tab-pane" id=alphabetical role=tabpanel>
        <!-- TODO: Entries with colons in name should turn into openable lists e.g. Reviews: -->
        <ul class="list-group navigation-list">
          {% for link in NameLinks %}
            {% if link.Sub %}
            <li><span class="octicon octicon-chevron-right"></span><a href="#alpha-nav-{{link.Id}}" data-toggle=collapse aria-expanded=false aria-controls="#alpha-nav-{{link.Id}}">{{link.Name}}</a></li>
            <ul class=collapse id="alpha-nav-{{link.Id}}" class="list-group navigation-list">
              {% for link in link.Sub %}
              <li><a href="#name/{{link.Href}}">{{link.Name}}</a></li>
              {% endfor %}
            </ul>
              
            {% else %}
              <li><a href="#name/{{link.Name}}">{{link.Name}}</a></li>
            {% endif %}
          {% endfor %}
        </ul>
      </div>

      <!-- Tagged navigation links -->
      <div class=tab-pane id=tag role=tabpanel>
        <ul class="list-group navigation-list">
          {% for link in TagLinks %}
          <li><a href="#tag/{{link.Name}}">#{{link.Name}}</a> ({{link.Count}})</li>
          {% endfor %}
        </ul>
      </div>
      <!--<p>NOTE: A new entry should be created simply by typing rather than using the calendar.</p>-->
    </div>
  </div>

  <div class=tab-content>
  
  </div>

  <div class=col-sm-10 id=journal-ui>
  </div>
</div>
{% endblock %}

{% block script %}
<script src="/assets/vendor/jquery-ui/jquery-ui.min.js"></script>

<script src="/assets/journal.js"></script>
<script type=riot/tag src="/assets/journal-tag.tag"></script>

<script type="text/javascript">
$(document).ready(function() {
  // Transform prefixed title links into expandable lists
  // e.g.
  // Review: Book1 
  // Review: Book2
  // becomes 
  // Review ->
  // -> Book1
  // -> Book2
  var name_links_finish = [], name_links = [
  {% for link in NameLinks %}
    { name: "{{link.Name}}" },
  {% endfor %}
  ];
  for(var i = 0; i != name_links.length; i++) {
    var link = name_links[i];
    var parts = link.name.split(':');
    if(parts.length == 2) {

    } else {
      name_links_finish.push(link);

    }
    // List is already sorted

  }
  console.log(name_links_finish)

  window.Journal.main();
});

</script>
{% endblock %}
